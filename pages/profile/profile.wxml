<view class="container theme-bg-diablo">
  <view class="bg-particles"></view>
  <view class="bg-texture"></view>

  <view class="page-content">
    
    <view class="login-gate animate-enter" wx:if="{{!isLoggedIn}}">
      <view class="gate-icon-wrapper">
        <image class="gate-icon" src="/images/7.png" mode="aspectFit" />
        <view class="gate-glow"></view>
      </view>
      <text class="gate-title">圣殿的大门紧闭</text>
      <text class="gate-subtitle">只有真正的英雄才能通过</text>
      
      <button class="btn-primary login-btn" bindtap="wxLogin">
        <text>开启旅程 (微信登录)</text>
      </button>
    </view>

    <view class="profile-dashboard" wx:else>
      
      <view class="hero-card glass-card animate-enter">
        <view class="hero-header">
          <view class="avatar-rune-wrapper" bindtap="uploadAvatar">
            <view class="rune-ring {{uploadingAvatar ? 'spinning' : ''}}"></view>
            <image class="avatar" src="{{userInfo.avatarUrl || '/images/default-avatar.png'}}" mode="aspectFill" />
            <view class="avatar-badge">
              <icon type="success" size="12" color="#000" wx:if="{{!uploadingAvatar}}"/>
            </view>
          </view>
          
          <view class="hero-info">
            <view class="name-row">
              <block wx:if="{{!editing}}">
                <text class="hero-name gold-text">{{userInfo.nickName}}</text>
                <view class="edit-icon-wrapper" bindtap="startEditNickName">
                  <text class="edit-icon">✎</text>
                </view>
              </block>
              <block wx:else>
                <input class="hero-name-input glass-pill" 
                       value="{{tempNickName}}" 
                       focus="{{editing}}"
                       bindinput="onNickNameInput"
                       bindblur="saveNickName"
                       bindconfirm="saveNickName"/>
              </block>
            </view>
            <text class="hero-class">{{userTitle || '流浪者'}} (Lv.{{userLevel || 1}})</text>
          </view>
        </view>

        <view class="card-bg-decoration"></view>
      </view>

      <view class="stats-row animate-enter delay-1">
        <view class="stat-item glass-card" bindtap="viewCollectionStats">
          <text class="stat-label">卷轴已展开</text>
          <text class="stat-value gold-text">{{collectionStats.completionRate}}%</text>
          <view class="stat-bar-bg">
            <view class="stat-bar-fill" style="width: {{collectionStats.completionRate}}%"></view>
          </view>
        </view>
        <view class="stat-item glass-card" bindtap="viewCollectionStats">
          <text class="stat-label">圣物收集</text>
          <text class="stat-value">{{collectionStats.activatedCount}} <text class="stat-sub">/ {{collectionStats.totalCount}}</text></text>
        </view>
      </view>

      <view class="menu-list animate-enter delay-2">
        <view class="menu-group-title decorative-line">系统选项</view>
        
        <view class="menu-item glass-card" bindtap="viewCollectionStats">
          <view class="menu-left">
            <image class="menu-icon" src="/images/1.png" mode="aspectFit" />
            <text class="menu-text">赫拉迪姆图鉴</text>
          </view>
          <text class="menu-arrow">></text>
        </view>

        <view class="menu-item glass-card" bindtap="viewAchievements">
          <view class="menu-left">
            <image class="menu-icon" src="/images/5.png" mode="aspectFit" />
            <text class="menu-text">英雄的旗帜</text>
          </view>
          <view class="menu-right">
            <text class="menu-tag">开发中</text>
            <text class="menu-arrow">></text>
          </view>
        </view>

        <view class="menu-item glass-card logout" bindtap="logout">
          <view class="menu-left">
            <image class="menu-icon" src="/images/8.png" mode="aspectFit" />
            <text class="menu-text">重置人物属性 (退出登陆)</text>
          </view>
        </view>
      </view>

    </view>
  </view>
</view>