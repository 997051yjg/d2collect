<view class="container theme-bg-diablo">
  <view class="bg-particles"></view>
  <view class="bg-texture"></view>

  <view class="page-content">

    <view class="seek-mode animate-enter" wx:if="{{!selectedEquipment}}">
      
      <view class="seek-header">
        <image class="horadric-icon" src="/images/9.png" mode="aspectFit" />
        <text class="seek-title">èµ«æ‹‰è¿ªå§†é‰´è¯†å°</text>
        <text class="seek-subtitle">è¾“å…¥åç§°ä»¥æ£€ç´¢å›¾é‰´ä¸­çš„è£…å¤‡</text>
      </view>

      <view class="search-core glass-card">
        <view class="ios-search-bar large">
          <icon type="search" size="20" color="var(--gold)"/>
          <input class="ios-search-input" 
                 placeholder="ä¾‹å¦‚ï¼šç‹®é¹«ä¹‹çœ¼ã€é£ä¹‹åŠ›..." 
                 placeholder-class="ios-search-placeholder"
                 value="{{searchKeyword}}"
                 bindinput="onSearchInput"
                 focus="{{!selectedEquipment}}"
                 confirm-type="search"/>
          <view class="search-loader" wx:if="{{searching}}"></view>
        </view>
      </view>

      <view class="inventory-grid animate-enter" wx:if="{{searchResults.length > 0}}">
        <view class="grid-label decorative-line">åŒ¹é…ç»“æœ</view>
        
        <view class="inventory-item glass-card {{item.rarity === 'å¥—è£…' ? 'set-glow' : 'unique-glow'}}" 
              wx:for="{{searchResults}}" 
              wx:key="_id"
              bindtap="onSelectSearchResult"
              data-index="{{index}}">
          
          <view class="item-visual">
            <image class="item-icon" src="{{item.image || '/images/1.png'}}" mode="aspectFit"/>
          </view>
          
          <view class="item-meta">
            <text class="item-name {{item.rarity === 'å¥—è£…' ? 'green-text' : 'gold-text'}}">{{item.name}}</text>
            <text class="item-type">{{item.type}}</text>
          </view>

          <view class="identify-btn">é‰´å®š</view>
        </view>
      </view>

      <view class="empty-guide" wx:if="{{searchKeyword && searchResults.length === 0}}">
        <text>æœªåœ¨å·è½´ä¸­æ‰¾åˆ°è¯¥ç‰©å“...</text>
      </view>
    </view>


    <view class="identify-mode animate-enter" wx:else>
      
      <view class="top-bar">
        <view class="back-btn glass-pill" bindtap="resetToSearchMode">
          <text class="back-icon">â†©</text>
          <text>é‡é€‰è£…å¤‡</text>
        </view>
      </view>

      <view class="artifact-card glass-card {{selectedEquipment.rarity === 'å¥—è£…' ? 'border-green' : 'border-gold'}}">
        <view class="artifact-header">
          <image class="artifact-icon" src="{{selectedEquipment.image || '/images/1.png'}}" mode="aspectFit" />
          
          <view class="artifact-titles">
            <text class="artifact-name {{selectedEquipment.rarity === 'å¥—è£…' ? 'green-text' : 'gold-text'}}">{{selectedEquipment.name}}</text>
            
            <view class="artifact-tags">
              <text class="rarity-pill {{selectedEquipment.rarity === 'å¥—è£…' ? 'suit' : (selectedEquipment.rarity === 'ç¬¦æ–‡ä¹‹è¯­' ? 'runeword' : 'unique')}}">{{selectedEquipment.rarity}}</text>
            </view>
          </view>
        </view>
      </view>

      <view class="inscription-section">
        <view class="section-header">
          <text class="section-title decorative-line">å±æ€§é“­åˆ»</text>
        </view>

        <view class="attr-list">
          <block wx:for="{{selectedEquipment.attributes}}" wx:key="code">
            
            <view class="attr-row variable glass-card" wx:if="{{item.isVariable}}">
              <view class="attr-meta">
                <text class="attr-label" style="color: {{item.displayColor}}">{{item.label}}</text>
                <text class="attr-range">[{{item.min}} ~ {{item.max}}]</text>
              </view>
              <input class="attr-input gold-text" 
                     type="number" 
                     placeholder="?" 
                     placeholder-class="dim-placeholder"
                     value="{{formData.attributes[item.code]}}"
                     bindinput="onAttributeInput"
                     bindblur="onAttributeBlur" 
                     data-code="{{item.code}}"/>
            </view>

            <view class="attr-row fixed" wx:else>
              <text class="attr-fixed-text" style="color: {{item.displayColor}}">{{item.displayText}}</text>
            </view>

          </block>

          <view class="no-attrs" wx:if="{{selectedEquipment.attributes.length === 0}}">
            <text>æ­¤ç‰©å“æ— ç‰¹æ®Šå˜åŠ¨å±æ€§</text>
          </view>
        </view>
      </view>

      <view class="evidence-section">
        <view class="section-header">
          <text class="section-title decorative-line">å½±åƒè®°å½•</text>
        </view>

        <view class="upload-zone glass-card {{uploadedImage ? 'filled' : ''}}" bindtap="{{uploadedImage ? '' : 'chooseImage'}}">
          
          <block wx:if="{{uploadedImage}}">
            <image class="preview-img" src="{{uploadedImage}}" mode="aspectFit"/>
            <view class="upload-actions">
              <view class="action-btn remove glass-pill" catchtap="removeImage">ç§»é™¤</view>
            </view>
          </block>

          <block wx:else>
            <view class="upload-placeholder">
              <text class="upload-icon-big">ğŸ“·</text>
              <text class="upload-hint">ç‚¹å‡»ä¸Šä¼ è£…å¤‡æˆªå›¾</text>
              <text class="upload-sub">æ”¯æŒè‡ªåŠ¨å‹ç¼©</text>
            </view>
          </block>

        </view>
      </view>

      <view class="submit-bar">
        <view class="submit-btn {{(!canSubmit || uploading) ? 'disabled' : ''}}" 
              bindtap="{{(!canSubmit || uploading) ? '' : 'submitForm'}}">
          
          <text class="btn-text">{{uploading ? 'é“­åˆ»ä¸­...' : 'ç¡®è®¤æ”¶å½•'}}</text>
          
          <view class="btn-shine" wx:if="{{canSubmit && !uploading}}"></view>
        </view>
      </view>

      <view style="height: 60rpx;"></view>
    </view>

  </view>
</view>