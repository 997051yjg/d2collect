<!--pages/upload/upload.wxml-->
<view class="container">
  <!-- ç™»å½•æç¤º -->
  <view class="login-prompt" wx:if="{{!isLoggedIn}}">
    <view class="login-prompt-card card">
      <text class="login-prompt-title">éœ€è¦ç™»å½•</text>
      <text class="login-prompt-desc">è¯·å…ˆç™»å½•åæ‰èƒ½ä¸Šä¼ è£…å¤‡</text>
      <button class="btn-primary login-btn" bindtap="goToLogin">å»ç™»å½•</button>
    </view>
  </view>

  <!-- ä¸Šä¼ ç•Œé¢ -->
  <view class="upload-section" wx:if="{{isLoggedIn}}">
    <!-- å›¾ç‰‡ä¸Šä¼ åŒºåŸŸ -->
    <view class="upload-area card">
      <view class="upload-header">
        <text class="upload-title gold-text">ä¸Šä¼ è£…å¤‡å›¾ç‰‡</text>
        <text class="upload-tip">æ”¯æŒJPGã€PNGæ ¼å¼ï¼Œæœ€å¤§5MB</text>
      </view>
      
      <view class="image-preview" wx:if="{{uploadedImage}}">
        <image class="preview-image" src="{{uploadedImage}}" mode="aspectFit"></image>
        <view class="preview-actions">
          <button class="btn-secondary" bindtap="removeImage">åˆ é™¤</button>
          <button class="btn-primary" bindtap="reuploadImage">é‡æ–°ä¸Šä¼ </button>
        </view>
      </view>
      
      <view class="upload-button" wx:else>
        <view class="upload-icon">ğŸ“·</view>
        <text class="upload-text">ç‚¹å‡»é€‰æ‹©å›¾ç‰‡</text>
        <button class="upload-btn" bindtap="chooseImage" size="mini">é€‰æ‹©å›¾ç‰‡</button>
      </view>
    </view>

    <!-- è£…å¤‡ä¿¡æ¯è¡¨å• -->
    <view class="form-section card" wx:if="{{uploadedImage}}">
      <view class="form-header">
        <text class="form-title gold-text">è£…å¤‡ä¿¡æ¯</text>
      </view>
      
      <form bindsubmit="submitForm">
        <!-- è£…å¤‡åç§°æœç´¢ -->
        <view class="form-group">
          <label class="form-label">è£…å¤‡åç§°</label>
          <view class="search-container">
            <input 
              class="input search-input" 
              name="name" 
              placeholder="è¾“å…¥è£…å¤‡åç§°å…³é”®å­—æœç´¢" 
              value="{{formData.name}}" 
              bindinput="onNameInput"
              bindblur="onInputBlur"
            />
            
            <!-- æœç´¢ç»“æœ -->
            <view class="search-results" wx:if="{{showSearchResults}}">
              <view 
                class="search-result-item" 
                wx:for="{{searchResults}}" 
                wx:key="index"
                bindtap="selectEquipment"
                data-index="{{index}}"
              >
                <text class="result-name">{{item.name}}</text>
                <text class="result-type">{{item.type}} - {{item.rarity}}</text>
              </view>
            </view>
          </view>
          
          <!-- é€‰ä¸­çš„è£…å¤‡ä¿¡æ¯ -->
          <view class="selected-equipment" wx:if="{{selectedEquipment}}">
            <text class="selected-name">{{selectedEquipment.name}}</text>
            <text class="selected-info">{{selectedEquipment.type}} - {{selectedEquipment.rarity}}</text>
          </view>
        </view>
        
        <view class="form-actions">
          <button class="btn-secondary" form-type="reset" bindtap="resetForm">é‡ç½®</button>
          <button class="btn-primary" form-type="submit" disabled="{{!canSubmit}}">æäº¤ä¸Šä¼ </button>
        </view>
      </form>
    </view>

    <!-- ä¸Šä¼ è¿›åº¦ -->
    <view class="upload-progress" wx:if="{{uploading}}">
      <view class="progress-card card">
        <text class="progress-title">ä¸Šä¼ ä¸­...</text>
        <progress class="progress-bar" percent="{{uploadProgress}}" show-info />
        <text class="progress-text">{{uploadProgress}}%</text>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>
</view>