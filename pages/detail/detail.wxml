<!-- pages/detail/detail.wxml -->

<view class="detail-container">
  <!-- 加载状态 -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <text class="loading-text">加载中...</text>
  </view>

  <!-- 装备详情 -->
  <view wx:if="{{!loading && equipment}}" class="equipment-detail">
    <!-- 顶部信息布局 - 左侧信息，中间图片 -->
    <view class="equipment-header-layout">
      <!-- 左侧信息 -->
      <view class="equipment-info-left">
        <view class="equipment-icon">
          <image class="icon-image" src="{{getEquipmentIcon(equipment.type)}}" mode="aspectFit" />
        </view>
        <view class="info">
          <text class="name">{{equipment.name}}</text>
          <text class="type">{{equipment.type}} · {{equipment.rarity}}</text>
          <view class="status {{isActivated ? 'activated' : 'not-activated'}}">
            {{isActivated ? '已激活' : '未激活'}}
          </view>
        </view>
      </view>
      
      <!-- 中间装备图片 -->
      <view class="equipment-image-center">
        <image class="main-equipment-image" src="{{equipment.image || getEquipmentIcon(equipment.type)}}" mode="aspectFit" />
      </view>
    </view>

    <!-- 多图片预览卡片 - 横向布局 -->
    <view class="images-section" wx:if="{{isActivated && userEquipment && userEquipment.images && userEquipment.images.length > 0}}">
      <view class="section-title">装备图片</view>
      <view class="images-container">
        <scroll-view class="images-scroll" scroll-x="true" scroll-left="{{scrollLeft}}" show-scrollbar="false">
          <view class="images-list">
            <block wx:for="{{userEquipment.images}}" wx:key="*this" wx:for-item="image" wx:for-index="index">
              <view class="image-thumbnail" bindtap="viewImage" data-image="{{image}}" data-index="{{index}}">
                <image src="{{image}}" class="thumbnail-image" mode="aspectFill" />
                <view class="thumbnail-overlay" wx:if="{{currentImageIndex === index}}">
                  <text class="thumbnail-text">当前</text>
                </view>
              </view>
            </block>
          </view>
        </scroll-view>
      </view>
    </view>

    <!-- 装备属性卡片 -->
    <view class="attributes-section">
      <view class="section-title">装备属性</view>
      <view class="attributes-list">
        <view class="attribute-item" wx:if="{{equipment.stats}}">
          <text class="label">属性：</text>
          <text class="value">{{equipment.stats}}</text>
        </view>
        <view class="attribute-item" wx:if="{{equipment.requiredLevel}}">
          <text class="label">需求等级：</text>
          <text class="value">{{equipment.requiredLevel}}</text>
        </view>
      </view>
    </view>

    <!-- 收藏者信息卡片 -->
    <view class="collector-section" wx:if="{{isActivated && userInfo}}">
      <view class="section-title">收藏者</view>
      <view class="collector-content">
        <image class="collector-avatar" src="{{userInfo.avatarUrl}}" mode="aspectFill" />
        <view class="collector-info">
          <text class="collector-nickname">{{userInfo.nickName}}</text>
          <text class="collector-badge">装备收藏者</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 装备不存在 -->
  <view wx:if="{{!loading && !equipment}}" class="not-found">
    <view class="not-found-icon">❓</view>
    <text class="not-found-text">装备不存在</text>
    <button class="btn-back" bindtap="onBack">返回</button>
  </view>

  <!-- 隐藏的canvas用于生成分享图片 -->
  <canvas 
    canvas-id="shareCanvas" 
    style="width: 750rpx; height: 1000rpx; position: fixed; top: -9999rpx; left: -9999rpx;"
  ></canvas>
</view>