<view class="performance-page">
  <!-- 头部 -->
  <view class="header">
    <text class="title">性能监控面板</text>
    <text class="subtitle">实时监控小程序性能指标</text>
  </view>

  <!-- 控制面板 -->
  <view class="control-panel">
    <view class="control-item">
      <text class="control-label">性能监控状态：</text>
      <switch checked="{{isMonitoring}}" bindchange="toggleMonitoring" />
      <text class="control-status">{{isMonitoring ? '已开启' : '已关闭'}}</text>
    </view>
    
    <view class="control-buttons">
      <button class="btn btn-primary" bindtap="runPerformanceTest">运行性能测试</button>
      <button class="btn btn-secondary" bindtap="clearPerformanceData">清空性能数据</button>
      <button class="btn btn-warning" bindtap="clearCache">清理缓存</button>
      <button class="btn btn-info" bindtap="exportReport">导出报告</button>
    </view>
  </view>

  <!-- 系统信息 -->
  <view class="info-section">
    <view class="section-title">系统信息</view>
    <view class="info-grid">
      <view class="info-item">
        <text class="info-label">缓存使用</text>
        <text class="info-value">{{cacheInfo.totalSize || 0}}KB / {{cacheInfo.limitSize || 1024}}KB</text>
        <text class="info-percent">{{((cacheInfo.totalSize || 0) / (cacheInfo.limitSize || 1024) * 100).toFixed(1)}}%</text>
      </view>
      
      <view class="info-item">
        <text class="info-label">缓存数量</text>
        <text class="info-value">{{cacheInfo.cacheCount || 0}} 个</text>
        <text class="info-percent">性能缓存: {{cacheInfo.performanceCacheCount || 0}} 个</text>
      </view>
      
      <view class="info-item">
        <text class="info-label">内存使用</text>
        <text class="info-value">{{memoryInfo.usedMemory || 0}}MB</text>
        <text class="info-percent">监控数据: {{memoryInfo.performanceDataCount || 0}} 条</text>
      </view>
      
      <view class="info-item">
        <text class="info-label">活动计时器</text>
        <text class="info-value">{{memoryInfo.activeTimers || 0}} 个</text>
        <text class="info-percent">实时监控</text>
      </view>
    </view>
  </view>

  <!-- 性能指标 -->
  <view class="metrics-section">
    <view class="section-title">性能指标</view>
    
    <view wx:for="{{performanceReport}}" wx:for-item="metric" wx:for-index="metricName" wx:key="metricName" class="metric-card">
      <view class="metric-header">
        <text class="metric-name">{{metricName}}</text>
        <text class="metric-count">{{metric.count}} 次</text>
      </view>
      
      <view class="metric-stats">
        <view class="stat-item">
          <text class="stat-label">平均</text>
          <text class="stat-value">{{metric.average}}ms</text>
        </view>
        
        <view class="stat-item">
          <text class="stat-label">中位数</text>
          <text class="stat-value">{{metric.median}}ms</text>
        </view>
        
        <view class="stat-item">
          <text class="stat-label">P95</text>
          <text class="stat-value">{{metric.p95}}ms</text>
        </view>
        
        <view class="stat-item">
          <text class="stat-label">最小值</text>
          <text class="stat-value">{{metric.min}}ms</text>
        </view>
        
        <view class="stat-item">
          <text class="stat-label">最大值</text>
          <text class="stat-value">{{metric.max}}ms</text>
        </view>
      </view>
      
      <view class="metric-bar">
        <view class="bar-container">
          <view class="bar-fill" style="width: {{(metric.average / (metric.max || 1000) * 100)}}%"></view>
        </view>
        <text class="bar-label">性能趋势</text>
      </view>
    </view>
    
    <view wx:if="{{Object.keys(performanceReport).length === 0}}" class="no-data">
      <text class="no-data-text">暂无性能数据，请先运行性能测试</text>
    </view>
  </view>

  <!-- 优化建议 -->
  <view class="suggestions-section">
    <view class="section-title">优化建议</view>
    <view class="suggestions-list">
      <view class="suggestion-item">
        <text class="suggestion-icon">✅</text>
        <text class="suggestion-text">数据库查询已优化，使用缓存和并行查询</text>
      </view>
      
      <view class="suggestion-item">
        <text class="suggestion-icon">✅</text>
        <text class="suggestion-text">图片加载已优化，添加懒加载和错误处理</text>
      </view>
      
      <view class="suggestion-item">
        <text class="suggestion-icon">✅</text>
        <text class="suggestion-text">事件处理已优化，使用防抖机制</text>
      </view>
      
      <view class="suggestion-item">
        <text class="suggestion-icon">✅</text>
        <text class="suggestion-text">setData调用已优化，减少不必要的渲染</text>
      </view>
      
      <view class="suggestion-item">
        <text class="suggestion-icon">📊</text>
        <text class="suggestion-text">性能监控工具已集成，可实时监控性能</text>
      </view>
    </view>
  </view>
</view>