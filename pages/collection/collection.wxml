<!--pages/collection/collection.wxml-->
<view class="container">
  <!-- 顶部筛选栏 -->
  <view class="filter-section">
    <!-- 搜索栏 -->
    <view class="search-bar">
      <input class="search-input" 
             placeholder="搜索装备名称、类型或稀有度..." 
             bindinput="onSearchInput" 
             value="{{searchKeyword}}" />
    </view>
    
    <!-- 快速筛选栏 -->
    <view class="quick-filter-bar">
      <view class="filter-tabs">
        <view class="filter-tab {{currentFilter === 'all' ? 'active' : ''}}" 
              bindtap="setFilter" data-filter="all">全部</view>
        <view class="filter-tab {{currentFilter === 'weapon' ? 'active' : ''}}" 
              bindtap="setFilter" data-filter="weapon">武器</view>
        <view class="filter-tab {{currentFilter === 'armor' ? 'active' : ''}}" 
              bindtap="setFilter" data-filter="armor">防具</view>
        <view class="filter-tab {{currentFilter === 'accessory' ? 'active' : ''}}" 
              bindtap="setFilter" data-filter="accessory">饰品</view>
        <view class="filter-tab {{currentFilter === 'active' ? 'active' : ''}}" 
              bindtap="setFilter" data-filter="active">已激活</view>
      </view>
      
      <!-- 排序和筛选按钮 -->
      <view class="sort-controls">
        <view class="sort-btn" bindtap="toggleFilterPanel">
          <text class="sort-icon">⚙️</text>
          <text class="sort-text">筛选</text>
        </view>
        <view class="sort-btn {{sortBy === 'name' ? 'selected' : ''}}" bindtap="toggleSort" data-sort-by="name">
          <text class="sort-icon">{{sortBy === 'name' ? (sortOrder === 'asc' ? '▲' : '▼') : '⇅'}}</text>
          <text class="sort-text">名称</text>
        </view>
        <view class="sort-btn {{sortBy === 'rarity' ? 'selected' : ''}}" bindtap="toggleSort" data-sort-by="rarity">
          <text class="sort-icon">{{sortBy === 'rarity' ? (sortOrder === 'asc' ? '▲' : '▼') : '⇅'}}</text>
          <text class="sort-text">稀有度</text>
        </view>
      </view>
    </view>
    
    <!-- 高级筛选面板 -->
    <view class="filter-panel {{showFilterPanel ? 'show' : ''}}">
      <view class="filter-group">
        <text class="filter-label">稀有度筛选</text>
        <view class="rarity-filters">
          <view class="rarity-filter {{currentRarityFilter === 'all' ? 'active' : ''}}" 
                bindtap="setRarityFilter" data-rarity="all">全部</view>
          <view class="rarity-filter {{currentRarityFilter === '套装' ? 'active' : ''}}" 
                bindtap="setRarityFilter" data-rarity="套装">套装</view>
          <view class="rarity-filter {{currentRarityFilter === '暗金' ? 'active' : ''}}" 
                bindtap="setRarityFilter" data-rarity="暗金">暗金</view>
          <view class="rarity-filter {{currentRarityFilter === '符文之语' ? 'active' : ''}}" 
                bindtap="setRarityFilter" data-rarity="符文之语">符文之语</view>
        </view>
      </view>
      
      <view class="filter-actions">
        <view class="filter-btn" bindtap="toggleFilterPanel">关闭</view>
        <view class="filter-btn reset" bindtap="resetFilters">重置</view>
      </view>
    </view>
  </view>



  <!-- 图鉴列表 -->
  <view class="collection-section">
    <!-- 搜索结果统计 -->
    <view class="search-stats" wx:if="{{filteredList.length > 0 && (searchKeyword || currentFilter !== 'all' || currentRarityFilter !== 'all')}}">
      <text class="search-stats-text">找到 {{filteredList.length}} 件装备</text>
    </view>
    
    <view class="collection-grid" wx:if="{{filteredList.length > 0}}">
      <view class="collection-item" 
            wx:for="{{filteredList}}" 
            wx:key="id"
            bindtap="viewEquipment" 
            data-id="{{item.id}}"
            data-activated="{{item.isActivated}}"
            bindlongpress="onLongPressEquipment"
            data-name="{{item.name}}">
        
        <!-- 装备卡片 -->
        <view class="equipment-card {{item.isActivated ? 'activated' : ''}}">
          <!-- 装备图片 -->
          <view class="equipment-image">
            <view class="image-placeholder">{{item.emoji}}</view>
            <!-- 已激活光晕效果 -->
            <view class="glow-effect" wx:if="{{item.isActivated}}"></view>
          </view>
          
          <!-- 装备信息 -->
          <view class="equipment-info">
            <text class="equipment-name">{{item.name}}</text>
            <text class="equipment-type">{{item.type}}</text>
            <view class="equipment-rarity {{item.rarity === '套装' ? 'suit' : 'unique'}}">
              {{item.rarity}}
            </view>
          </view>
          
          <!-- 激活状态 -->
          <view class="activation-status">
            <text class="status-text" wx:if="{{item.isActivated}}">已激活</text>
            <text class="status-text locked" wx:else>未激活</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 空状态 -->
    <view class="empty-state" wx:else>
      <view class="empty-icon">📚</view>
      <text class="empty-text">暂无图鉴数据</text>
      <text class="empty-subtext" wx:if="{{!isLoggedIn}}">请先登录</text>
      <text class="empty-subtext" wx:else>快去上传装备激活图鉴吧！</text>
    </view>
  </view>

  <!-- 加载状态 -->
  <view class="loading" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">加载中...</text>
  </view>
</view>