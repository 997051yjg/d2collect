<view class="container theme-bg-diablo">
  <view class="bg-particles"></view>
  <view class="bg-texture"></view>

  <view class="page-content">
    
    <view class="header-compact animate-enter">
      <view class="header-info">
        <text class="page-title">装备图鉴</text>
        <text class="page-subtitle decorative-line">Collection</text>
      </view>
      <view class="progress-card glass-card">
        <view class="progress-info">
          <text class="progress-label">收集进度</text>
          <text class="progress-val gold-text">{{collectionStats.activatedCount}} <text class="dim">/ {{collectionStats.totalCount}}</text></text>
        </view>
        <view class="progress-track">
          <view class="progress-fill" style="width: {{collectionStats.completionRate}}%"></view>
        </view>
      </view>
    </view>

    <view class="filter-zone animate-enter delay-1">
      
      <view class="ios-search-bar">
        <icon type="search" size="16" color="var(--text-secondary)"/>
        <input class="ios-search-input" 
               placeholder="搜索装备名称..." 
               placeholder-class="ios-search-placeholder"
               value="{{searchKeyword}}"
               bindinput="onSearchInput"
               confirm-type="search"/>
        <icon wx:if="{{searchKeyword}}" type="clear" size="16" color="#888" bindtap="clearSearch"/>
      </view>

      <scroll-view class="type-scroll" scroll-x enable-flex show-scrollbar="{{false}}">
        <view class="type-item {{currentTypeFilter === item.key ? 'active' : ''}}"
              wx:for="{{filterCategories}}" 
              wx:key="key"
              bindtap="setTypeFilter" 
              data-type="{{item.key}}">
          {{item.label}}
          <view class="active-indicator" wx:if="{{currentTypeFilter === item.key}}"></view>
        </view>
      </scroll-view>

      <view class="filter-chips">
        <view class="chip glass-pill {{advancedFilters.unique ? 'active-gold' : ''}}" bindtap="toggleAdvancedFilter" data-filter="unique">暗金</view>
        <view class="chip glass-pill {{advancedFilters.suit ? 'active-green' : ''}}" bindtap="toggleAdvancedFilter" data-filter="suit">套装</view>
        <view class="chip glass-pill {{advancedFilters.runeWord ? 'active-orange' : ''}}" bindtap="toggleAdvancedFilter" data-filter="runeWord">符文</view>
        <view class="chip glass-pill {{advancedFilters.activated ? 'active-dim' : ''}}" bindtap="toggleAdvancedFilter" data-filter="activated">已拥有</view>
        <view class="chip glass-pill {{advancedFilters.notActivated ? 'active-dim' : ''}}" bindtap="toggleAdvancedFilter" data-filter="notActivated">未拥有</view>
      </view>
    </view>

    <view class="grid-container animate-enter delay-2" wx:if="{{displayList.length > 0}}">
      <view class="collection-grid grid-3">
        <view class="grid-item" 
              wx:for="{{displayList}}" 
              wx:key="id"
              bindtap="viewEquipment" 
              bindlongpress="onLongPressEquipment"
              data-id="{{item.id}}"
              data-name="{{item.name}}"
              data-activated="{{item.isActivated}}">
          
          <view class="item-card glass-card {{item.isActivated ? 'owned' : ''}}">
            <image class="item-img" src="{{item.icon}}" mode="aspectFit" lazy-load binderror="onImageError" data-index="{{index}}" />
            
            <view class="rarity-dot {{item.rarityClass}}"></view>
            
            <view class="status-badge" wx:if="{{item.isActivated}}">
              <icon type="success_no_circle" size="10" color="#000" />
            </view>
          </view>
          
          <text class="item-name {{item.isActivated ? 'gold-text' : ''}}">{{item.name}}</text>
        </view>
      </view>
    </view>

    <view class="loading-more" wx:if="{{loading && displayList.length > 0}}">
      <view class="loading-spinner small"></view>
    </view>

    <view class="empty-state" wx:if="{{!loading && displayList.length === 0 && isLoggedIn}}">
      <image class="empty-icon" src="/images/4.png" mode="aspectFit" />
      <text class="empty-title">未找到装备</text>
      <text class="empty-desc">换个关键词或筛选条件试试吧</text>
      <view class="btn-primary" bindtap="resetFilters" style="margin-top: 30rpx;">重置筛选</view>
    </view>

    <view class="empty-state" wx:if="{{!isLoggedIn}}">
      <image class="empty-icon" src="/images/1.png" mode="aspectFit" />
      <text class="empty-title">圣殿的大门紧闭</text>
      <text class="empty-desc">登录以查阅赫拉迪克卷轴的记录</text>
      <view class="btn-primary" bindtap="wxLogin" style="margin-top: 30rpx;">点亮火把 (登录)</view>
    </view>

    <view class="loading-state" wx:if="{{loading && displayList.length === 0}}">
      <view class="loading-spinner"></view>
      <text class="loading-text">正在展开卷轴...</text>
    </view>

  </view>
</view>