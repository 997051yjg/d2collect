<!--pages/collection/collection.wxml-->
<view class="container">
  <!-- 顶部筛选栏 -->
  <view class="filter-section">
    <!-- 搜索栏 -->
    <view class="search-bar">
      <input class="search-input" 
             placeholder="搜索装备名称、类型或稀有度..." 
             bindinput="onSearchInput" 
             value="{{searchKeyword}}" />
    </view>
    
    <!-- 筛选下拉卡片 -->
    <view class="filter-dropdown">
      <view class="filter-toggle" bindtap="toggleFilterPanel">
        <text class="filter-toggle-text">筛选</text>
        <text class="filter-toggle-icon {{showFilterPanel ? 'active' : ''}}">▼</text>
      </view>
      
      <!-- 筛选面板 -->
      <view class="filter-panel {{showFilterPanel ? 'show' : ''}}">
        <!-- 装备类型筛选（单选） -->
        <view class="filter-group">
          <text class="filter-label">装备类型</text>
          <view class="type-filters">
            <view class="type-filter {{currentTypeFilter === 'all' ? 'active' : ''}}" 
                  bindtap="setTypeFilter" data-type="all">全部</view>
            <view class="type-filter {{currentTypeFilter === 'helmet' ? 'active' : ''}}" 
                  bindtap="setTypeFilter" data-type="helmet">头部</view>
            <view class="type-filter {{currentTypeFilter === 'armor' ? 'active' : ''}}" 
                  bindtap="setTypeFilter" data-type="armor">盔甲</view>
            <view class="type-filter {{currentTypeFilter === 'belt' ? 'active' : ''}}" 
                  bindtap="setTypeFilter" data-type="belt">腰带</view>
            <view class="type-filter {{currentTypeFilter === 'boots' ? 'active' : ''}}" 
                  bindtap="setTypeFilter" data-type="boots">鞋子</view>
            <view class="type-filter {{currentTypeFilter === 'gloves' ? 'active' : ''}}" 
                  bindtap="setTypeFilter" data-type="gloves">手套</view>
            <view class="type-filter {{currentTypeFilter === 'ring' ? 'active' : ''}}" 
                  bindtap="setTypeFilter" data-type="ring">戒指</view>
            <view class="type-filter {{currentTypeFilter === 'amulet' ? 'active' : ''}}" 
                  bindtap="setTypeFilter" data-type="amulet">项链</view>
            <view class="type-filter {{currentTypeFilter === 'weapon' ? 'active' : ''}}" 
                  bindtap="setTypeFilter" data-type="weapon">手持</view>
          </view>
        </view>
        
        <!-- 高级筛选（多选） -->
        <view class="filter-group">
          <text class="filter-label">高级筛选</text>
          <view class="advanced-filters">
            <view class="advanced-filter {{advancedFilters.unique ? 'active' : ''}}" 
                  bindtap="toggleAdvancedFilter" data-filter="unique">暗金</view>
            <view class="advanced-filter {{advancedFilters.suit ? 'active' : ''}}" 
                  bindtap="toggleAdvancedFilter" data-filter="suit">套装</view>
            <view class="advanced-filter {{advancedFilters.runeWord ? 'active' : ''}}" 
                  bindtap="toggleAdvancedFilter" data-filter="runeWord">符文之语</view>
            <view class="advanced-filter {{advancedFilters.activated ? 'active' : ''}}" 
                  bindtap="toggleAdvancedFilter" data-filter="activated">已激活</view>
            <view class="advanced-filter {{advancedFilters.notActivated ? 'active' : ''}}" 
                  bindtap="toggleAdvancedFilter" data-filter="notActivated">未激活</view>
          </view>
        </view>
        
        <!-- 筛选操作按钮 -->
        <view class="filter-actions">
          <view class="filter-btn reset" bindtap="resetFilters">重置</view>
        </view>
      </view>
    </view>
  </view>



  <!-- 图鉴列表 -->
  <view class="collection-section">
    <view class="collection-grid" wx:if="{{filteredList.length > 0}}">
      <view class="collection-item" 
            wx:for="{{displayList}}" 
            wx:key="id"
            bindtap="viewEquipment" 
            data-id="{{item.id}}"
            data-activated="{{item.isActivated}}"
            bindlongpress="onLongPressEquipment"
            data-name="{{item.name}}">
        
        <!-- 装备卡片 -->
        <view class="equipment-card {{item.isActivated ? 'activated' : ''}}">
          <!-- 装备图片 -->
          <view class="equipment-image">
            <image class="equipment-icon" src="{{item.icon}}" mode="aspectFit" />
            <!-- 已激活光晕效果 -->
            <view class="glow-effect" wx:if="{{item.isActivated}}"></view>
          </view>
          
          <!-- 装备信息 -->
          <view class="equipment-info">
            <text class="equipment-name">{{item.name}}</text>
            <text class="equipment-type">{{item.type}}</text>
            <view class="equipment-rarity {{item.rarity === '套装' ? 'suit' : 'unique'}}">
              {{item.rarity}}
            </view>
          </view>
          
          <!-- 激活状态 -->
          <view class="activation-status">
            <text class="status-text" wx:if="{{item.isActivated}}">已激活</text>
            <text class="status-text locked" wx:else>未激活</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 空状态 -->
    <view class="empty-state" wx:else>
      <view class="empty-icon">...</view>
      <text class="empty-text">暂无图鉴数据</text>
      <text class="empty-subtext" wx:if="{{!isLoggedIn}}">请先登录</text>
      <text class="empty-subtext" wx:else>快去收集装备激活图鉴吧！</text>
    </view>
  </view>

  <!-- 加载状态 -->
  <view class="loading" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">加载中...</text>
  </view>
</view>