<!--pages/upload-quick/upload-quick.wxml-->
<view class="container">
  <!-- 登录提示 -->
  <view class="login-prompt" wx:if="{{!isLoggedIn}}">
    <view class="login-prompt-card card">
      <text class="login-prompt-title">需要登录</text>
      <text class="login-prompt-desc">请先登录后才能上传装备</text>
      <button class="btn-primary login-btn" bindtap="goToLogin">去登录</button>
    </view>
  </view>

  <!-- 上传界面 -->
  <view class="upload-section" wx:if="{{isLoggedIn}}">
    <!-- 预配置装备信息 -->
    <view class="equipment-info-card card animate-enter" wx:if="{{equipmentInfo}}">
      <view class="info-header">
        <text class="info-title gold-text">已选择装备</text>
      </view>
      
      <view class="equipment-preview">
        <!-- 装备图标 -->
        <view class="equipment-image">
          <image class="equipment-icon" src="{{equipmentInfo.image || '/images/1.png'}}" mode="aspectFit" />
        </view>
        
        <!-- 装备详细信息 -->
        <view class="equipment-details">
          <text class="equipment-name">{{equipmentInfo.name}}</text>
          <view class="detail-row">
            <text class="detail-label">装备类型：</text>
            <text class="detail-value">{{equipmentInfo.type}}</text>
          </view>
          <view class="detail-row">
            <text class="detail-label">稀有度：</text>
            <text class="detail-value {{equipmentInfo.rarity === '套装' ? 'suit' : 'unique'}}">{{equipmentInfo.rarity}}</text>
          </view>
          <view class="detail-row" wx:if="{{equipmentInfo.attributes && equipmentInfo.attributes.length > 0}}">
            <text class="detail-label">属性：</text>
            <text class="detail-value">{{equipmentInfo.attributes.length}} 个属性</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 属性编辑区域 -->
    <view class="attributes-section" wx:if="{{equipmentInfo.attributes && equipmentInfo.attributes.length > 0}}">
      <view class="section-divider"></view>
      <view class="attr-list">
        <block wx:for="{{equipmentInfo.attributes}}" wx:key="code">
          
          <view class="attr-row variable" wx:if="{{item.isVariable}}">
            <view class="attr-label" style="color: {{item.displayColor}}">
              {{item.label}}
              <text class="attr-range">({{item.min}}-{{item.max}})</text>
            </view>
            <input 
              class="attr-input" 
              type="number" 
              placeholder="{{item.min}}" 
              placeholder-class="input-placeholder"
              bindinput="onAttributeInput" 
              data-code="{{item.code}}"
              value="{{formData.attributes[item.code]}}"
            />
          </view>

          <view class="attr-row fixed" wx:else>
            <text class="attr-text" style="color: {{item.displayColor}}">
              {{item.displayText}}
            </text>
          </view>

        </block>
      </view>
    </view>

    <!-- 图片上传区域 -->
    <view class="upload-area card animate-enter delay-1">
      <view class="upload-header">
        <text class="upload-title gold-text">上传装备图片</text>
        <text class="upload-tip">支持JPG、PNG格式，最大5MB</text>
      </view>
      
      <view class="image-preview" wx:if="{{uploadedImage}}">
        <image class="preview-image" src="{{uploadedImage}}" mode="aspectFit"></image>
        <view class="preview-actions">
          <button class="btn-secondary" bindtap="removeImage">删除</button>
          <button class="btn-primary" bindtap="reuploadImage">重新选择</button>
        </view>
      </view>
      
      <view class="upload-button" wx:else>
        <view class="upload-icon"><image class="upload-icon-image" src="/images/2.png" mode="aspectFit" /></view>
        <text class="upload-text">点击选择图片</text>
        <button class="upload-btn" bindtap="chooseImage" size="mini">选择图片</button>
      </view>
    </view>

    <!-- 提交按钮 -->
    <view class="submit-section" wx:if="{{equipmentInfo}}">
      <button class="btn-submit" bindtap="submitForm" disabled="{{!canSubmit}}">
        {{canSubmit ? '上传装备' : '请先选择图片'}}
      </button>
    </view>

    <!-- 上传进度 -->
    <view class="upload-progress" wx:if="{{uploading}}">
      <view class="progress-card card">
        <text class="progress-title">上传中...</text>
        <progress class="progress-bar" percent="{{uploadProgress}}" show-info />
        <text class="progress-text">{{uploadProgress}}%</text>
      </view>
    </view>
  </view>

  <!-- 加载状态 -->
  <view class="loading" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">加载中...</text>
  </view>
</view>